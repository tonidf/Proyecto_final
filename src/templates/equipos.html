{% extends './layouts/layout.html'%}

{% block title %}Equipos{% endblock %}

{% block body %}
<div class="relative min-h-screen flex flex-col items-center pt-10 px-4">

    <!-- Capa oscura -->
    <div class="absolute inset-0 bg-black opacity-90 z-0"></div>

    <!-- Contenido -->
    <div class="relative z-20 w-full">
        <h1 class="text-white text-3xl font-bold text-center mb-8">EQUIPOS</h1>
        

        <div class="grid grid-cols-4 gap-x-4 gap-y-6 place-items-center">
            {% for e in equipos %}
            <a href="{{url_for('equipos.get_equipo', equipo_id=e[0])}}">
                <div class="relative group hover:bg-opacity-90 shadow-inner bg-white bg-opacity-20 rounded-xl p-6 mb-4 w-52 h-28 flex items-center justify-center">
                    <img src="{{ e[1] }}" class="group-hover:opacity-100 group-hover:w-24 group-hover:h-24 opacity-40 w-20 h-20 object-contain transition-all duration-300">
                    <i 
                    class="{% if e[0] in favoritos %}fas text-yellow-400{% else %}far text-white opacity-20 group-hover:text-black group-hover:opacity-100{% endif %} 
                            fa-star text-2xl absolute top-2 right-3 cursor-pointer transition-all" 
                    data-id="{{ e[0] }}" 
                    onclick="toggleFavoritoEquipo(event)">
                    </i>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function toggleFavoritoEquipo(event) {
    event.preventDefault();
    event.stopPropagation();

    const estrella = event.currentTarget;
    const equipoId = estrella.dataset.id;

    const esFavorito = estrella.classList.contains('fas');
    const method = esFavorito ? 'DELETE' : 'POST';

    fetch(`/favoritos/equipo/${equipoId}`, {
        method: method,
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'same-origin' // importante para que se envÃ­en las cookies
    })
    .then(response => {
        if (response.ok) {
            // Alternar clases visualmente
            estrella.classList.toggle('fas');
            estrella.classList.toggle('far');
            estrella.classList.toggle('text-yellow-400');
            estrella.classList.toggle('text-white');
            estrella.classList.toggle('opacity-20');
        } else {
            response.json().then(data => alert(data.message || 'Error'));
        }
    });
}
</script>
{% endblock %}
